<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#111827">
  <title>–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–µ –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏ ‚Äî —Ç—Ä–µ–Ω–∞–∂—ë—Ä</title>
  <style>
    :root {
      color-scheme: light dark;
      --font-family: "Inter", "SF Pro Text", "Segoe UI", system-ui, -apple-system, sans-serif;
      --mono-font: "Fira Code", "SFMono-Regular", Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --bg: #f4f5f7;
      --surface: rgba(255, 255, 255, 0.88);
      --surface-strong: #ffffff;
      --text: #1f2933;
      --muted: #52606d;
      --accent: #2563eb;
      --accent-strong: #1d4ed8;
      --danger: #dc2626;
      --success: #059669;
      --border: rgba(15, 23, 42, 0.12);
      --shadow: 0 20px 45px -25px rgba(15, 23, 42, 0.45);
    }

    [data-theme="dark"] {
      --bg: #0f172a;
      --surface: rgba(15, 23, 42, 0.85);
      --surface-strong: rgba(30, 41, 59, 0.9);
      --text: #f8fafc;
      --muted: #cbd5f5;
      --accent: #60a5fa;
      --accent-strong: #3b82f6;
      --danger: #f87171;
      --success: #34d399;
      --border: rgba(148, 163, 184, 0.18);
      --shadow: 0 24px 50px -30px rgba(15, 23, 42, 0.9);
    }

    @media (prefers-color-scheme: dark) {
      :root:not([data-theme="light"]) {
        --bg: #0f172a;
        --surface: rgba(15, 23, 42, 0.85);
        --surface-strong: rgba(30, 41, 59, 0.9);
        --text: #f8fafc;
        --muted: #cbd5f5;
        --accent: #60a5fa;
        --accent-strong: #3b82f6;
        --danger: #f87171;
        --success: #34d399;
        --border: rgba(148, 163, 184, 0.18);
        --shadow: 0 24px 50px -30px rgba(15, 23, 42, 0.9);
      }
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: var(--font-family);
      background: radial-gradient(circle at top, rgba(59, 130, 246, 0.09), transparent 60%), var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 1.5rem;
      transition: background 220ms ease-in-out, color 220ms ease-in-out;
    }

    main {
      width: min(720px, 100%);
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .app-title {
      margin: 0;
      font-size: clamp(1.5rem, 5vw, 2.2rem);
      letter-spacing: -0.01em;
    }

    .theme-toggle {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      background: var(--surface-strong);
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 0.4rem 0.9rem;
      font-size: 0.95rem;
      color: var(--text);
      cursor: pointer;
      transition: background 200ms ease, transform 200ms ease, border 200ms ease;
    }

    .theme-toggle:focus-visible {
      outline: 3px solid var(--accent);
      outline-offset: 2px;
    }

    .theme-toggle:hover {
      transform: translateY(-1px);
      background: var(--surface);
    }

    .card {
      background: var(--surface-strong);
      border: 1px solid var(--border);
      border-radius: 24px;
      padding: clamp(1.5rem, 3vw, 2.5rem);
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      gap: 1rem;
      transition: background 220ms ease, border 220ms ease, box-shadow 220ms ease;
    }

    .card h2 {
      margin: 0;
      font-size: clamp(1.25rem, 4vw, 1.8rem);
    }

    .question-meta {
      font-size: 0.95rem;
      color: var(--muted);
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      align-items: center;
    }

    .question-body {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .prompt {
      font-size: clamp(1.2rem, 5vw, 1.8rem);
      font-weight: 600;
      text-align: center;
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .text-input {
      width: 100%;
      padding: 0.85rem 1rem;
      font-size: 1.1rem;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: var(--surface);
      color: var(--text);
      transition: border 200ms ease, box-shadow 200ms ease;
    }

    .text-input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.2);
      outline: none;
    }

    .primary-btn {
      border: none;
      border-radius: 14px;
      padding: 0.9rem 1.2rem;
      font-size: 1.05rem;
      font-weight: 600;
      color: #fff;
      background: linear-gradient(135deg, var(--accent), var(--accent-strong));
      cursor: pointer;
      transition: transform 200ms ease, box-shadow 200ms ease, filter 200ms ease;
    }

    .primary-btn:disabled {
      cursor: not-allowed;
      opacity: 0.6;
      box-shadow: none;
    }

    .primary-btn:not(:disabled):hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 25px -12px rgba(37, 99, 235, 0.6);
    }

    .primary-btn:focus-visible {
      outline: 3px solid rgba(59, 130, 246, 0.35);
      outline-offset: 2px;
    }

    .options {
      display: grid;
      gap: 0.75rem;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    }

    .option-btn {
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 0.75rem 1rem;
      background: var(--surface);
      color: var(--text);
      font-size: 1rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 200ms ease, transform 200ms ease, border 200ms ease;
    }

    .option-btn:hover,
    .option-btn:focus-visible {
      background: var(--accent);
      color: #fff;
      border-color: transparent;
      outline: none;
      transform: translateY(-1px);
    }

    .feedback {
      padding: 1rem;
      border-radius: 18px;
      border: 1px solid var(--border);
      background: var(--surface);
      display: none;
      gap: 0.5rem;
      align-items: center;
      font-size: 0.95rem;
    }

    .feedback.visible {
      display: flex;
    }

    .feedback svg {
      width: 20px;
      height: 20px;
    }

    .feedback[data-type="success"] {
      border-color: rgba(5, 150, 105, 0.45);
      color: var(--success);
    }

    .feedback[data-type="error"] {
      border-color: rgba(220, 38, 38, 0.45);
      color: var(--danger);
    }

    .mnemonic {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      font-size: 0.95rem;
      color: var(--muted);
    }

    .ipa {
      font-family: var(--mono-font);
      font-size: 0.95rem;
      letter-spacing: 0.01em;
    }

    .progress-container {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .progress-text {
      font-size: 0.95rem;
      color: var(--muted);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: rgba(148, 163, 184, 0.28);
      border-radius: 999px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      width: 0;
      background: linear-gradient(135deg, var(--accent), var(--accent-strong));
      border-radius: inherit;
      transition: width 220ms ease;
    }

    .results {
      display: none;
      flex-direction: column;
      gap: 1rem;
    }

    .results.visible {
      display: flex;
    }

    .stat {
      font-size: 1.2rem;
      font-weight: 600;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.95rem;
    }

    th, td {
      padding: 0.75rem;
      text-align: left;
      border-bottom: 1px solid rgba(148, 163, 184, 0.2);
    }

    th {
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--muted);
    }

    .tag {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.25rem 0.65rem;
      border-radius: 999px;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .tag.success {
      background: rgba(5, 150, 105, 0.16);
      color: var(--success);
    }

    .tag.error {
      background: rgba(220, 38, 38, 0.16);
      color: var(--danger);
    }

    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
    }

    .secondary-btn {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 0.75rem 1rem;
      background: var(--surface);
      color: var(--text);
      font-weight: 500;
      cursor: pointer;
      transition: background 200ms ease, border 200ms ease, transform 200ms ease;
    }

    .secondary-btn:hover,
    .secondary-btn:focus-visible {
      background: var(--accent);
      color: #fff;
      border-color: transparent;
      transform: translateY(-1px);
      outline: none;
    }

    dialog {
      width: min(480px, 90vw);
      border: none;
      border-radius: 20px;
      padding: 1.5rem;
      background: var(--surface-strong);
      color: var(--text);
      box-shadow: var(--shadow);
    }

    dialog::backdrop {
      background: rgba(15, 23, 42, 0.35);
      backdrop-filter: blur(4px);
    }

    dialog h3 {
      margin-top: 0;
    }

    .modal-table {
      margin-top: 1rem;
      border: 1px solid var(--border);
      border-radius: 16px;
      overflow: hidden;
    }

    .helper-link {
      display: inline-flex;
      margin-top: 1.5rem;
      align-items: center;
      gap: 0.5rem;
      color: var(--accent);
      cursor: pointer;
      font-weight: 600;
      text-decoration: none;
      border-bottom: 1px solid transparent;
      padding-bottom: 0.1rem;
      transition: border 200ms ease;
    }

    .helper-link:hover,
    .helper-link:focus-visible {
      border-bottom-color: currentColor;
      outline: none;
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    @media (min-width: 768px) {
      body {
        padding: 3rem;
      }
    }
  </style>
</head>
<body>
  <main>
    <header>
      <h1 class="app-title">–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–µ –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏</h1>
      <button class="theme-toggle" id="themeToggle" type="button" aria-pressed="false">
        <span aria-hidden="true">üåó</span>
        <span>–¢–µ–º–∞</span>
      </button>
    </header>

    <section class="card" aria-live="polite" aria-atomic="true">
      <div class="question-meta">
        <span id="questionType">–¢–∏–ø –≤–æ–ø—Ä–æ—Å–∞</span>
        <span id="bestScore" aria-live="polite"></span>
      </div>
      <div class="question-body" id="questionBody">
        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≤–æ–ø—Ä–æ—Å–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω —Å–∫—Ä–∏–ø—Ç–æ–º -->
      </div>
      <div class="feedback" id="feedback" role="status"></div>
      <div class="progress-container">
        <div class="progress-text">
          <span id="progressText">–†–∞—É–Ω–¥ 0/8</span>
          <span id="scoreText">0 –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö</span>
        </div>
        <div class="progress-bar" aria-hidden="true">
          <div class="progress-fill" id="progressFill"></div>
        </div>
      </div>
    </section>

    <section class="card results" id="results" aria-live="polite" aria-hidden="true">
      <h2>–ò—Ç–æ–≥–∏ —Å–µ—Å—Å–∏–∏</h2>
      <p class="stat" id="finalScore"></p>
      <div class="actions">
        <button class="primary-btn" type="button" id="playAgain">–°—ã–≥—Ä–∞—Ç—å –µ—â—ë —Ä–∞–∑</button>
        <button class="secondary-btn" type="button" id="showAllDaysResults">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –¥–Ω–∏</button>
      </div>
      <div class="table-wrapper">
        <table aria-describedby="finalScore">
          <thead>
            <tr>
              <th scope="col">–†–∞—É–Ω–¥</th>
              <th scope="col">–í–æ–ø—Ä–æ—Å</th>
              <th scope="col">–û—Ç–≤–µ—Ç</th>
              <th scope="col">–°—Ç–∞—Ç—É—Å</th>
              <th scope="col">–ü—Ä–∞–≤–∏–ª—å–Ω–æ</th>
            </tr>
          </thead>
          <tbody id="resultsBody"></tbody>
        </table>
      </div>
    </section>

    <a class="helper-link" href="#" id="helperLink">–°–ø—Ä–∞–≤–∫–∞ / –ö–∞–∫ –ø—Ä–æ–∏–∑–Ω–æ—Å–∏—Ç—å ‚Üí</a>
  </main>

  <dialog id="daysModal" aria-modal="true" aria-labelledby="daysModalTitle">
    <form method="dialog">
      <h3 id="daysModalTitle">–í—Å–µ –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏</h3>
      <p>–§—Ä–∞–Ω—Ü—É–∑—Å–∫–æ–µ –Ω–∞–ø–∏—Å–∞–Ω–∏–µ, IPA –∏ —É–¥–æ–±–Ω–∞—è —Ä—É—Å—Å–∫–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞ –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏—è.</p>
      <div class="modal-table">
        <table>
          <thead>
            <tr>
              <th scope="col">FR</th>
              <th scope="col">IPA</th>
              <th scope="col">–†—É—Å. —Ç—Ä–∞–Ω—Å–∫—Ä.</th>
              <th scope="col">–ü–µ—Ä–µ–≤–æ–¥</th>
            </tr>
          </thead>
          <tbody id="modalBody"></tbody>
        </table>
      </div>
      <div style="text-align: right; margin-top: 1rem;">
        <button class="secondary-btn" value="cancel">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </form>
  </dialog>

  <script>
    // --- –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è ---
    const DAYS = [
      { ru: "–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫", fr: "lundi", ipa: "l≈ìÃÉ.di", ruPron: "–ª—ë–Ω–¥–∏" },
      { ru: "–≤—Ç–æ—Ä–Ω–∏–∫", fr: "mardi", ipa: "ma Å.di", ruPron: "–º–∞—Ä–¥–∏" },
      { ru: "—Å—Ä–µ–¥–∞", fr: "mercredi", ipa: "m…õ Å.k Å…ô.di", ruPron: "–º—ç—Ä–∫—Ä—ç–¥–∏" },
      { ru: "—á–µ—Ç–≤–µ—Ä–≥", fr: "jeudi", ipa: " í√∏.di", ruPron: "–∂—ë–¥–∏" },
      { ru: "–ø—è—Ç–Ω–∏—Ü–∞", fr: "vendredi", ipa: "v…ëÃÉ.d Å…ô.di", ruPron: "–≤–∞–Ω–¥—Ä—ç–¥–∏" },
      { ru: "—Å—É–±–±–æ—Ç–∞", fr: "samedi", ipa: "sam.di", ruPron: "—Å–∞–º–¥–∏" },
      { ru: "–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ", fr: "dimanche", ipa: "di.m…ëÃÉ É", ruPron: "–¥–∏–º–∞–Ω—à" }
    ];

    // --- –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ---
    const TOTAL_ROUNDS = 8;
    const QUESTION_TYPES = {
      INPUT: "input",
      CHOICE: "choice"
    };

    // --- –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ ---
    const questionBody = document.getElementById("questionBody");
    const questionTypeLabel = document.getElementById("questionType");
    const feedback = document.getElementById("feedback");
    const progressText = document.getElementById("progressText");
    const scoreText = document.getElementById("scoreText");
    const progressFill = document.getElementById("progressFill");
    const resultsSection = document.getElementById("results");
    const resultsBody = document.getElementById("resultsBody");
    const finalScore = document.getElementById("finalScore");
    const playAgainBtn = document.getElementById("playAgain");
    const showAllDaysBtn = document.getElementById("showAllDaysResults");
    const helperLink = document.getElementById("helperLink");
    const daysModal = document.getElementById("daysModal");
    const modalBody = document.getElementById("modalBody");
    const bestScoreEl = document.getElementById("bestScore");
    const themeToggle = document.getElementById("themeToggle");

    // --- –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Å—Å–∏–∏ ---
    let dayDeck = [];
    let currentRound = 0;
    let correctCount = 0;
    let questionHistory = [];
    let currentQuestion = null;
    let bestScore = loadBestScore();

    // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---
    applyStoredTheme();
    updateBestScoreBadge();
    populateModal();
    startSession();

    // --- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ ---
    playAgainBtn.addEventListener("click", startSession);
    showAllDaysBtn.addEventListener("click", () => openModal(daysModal));
    helperLink.addEventListener("click", (event) => {
      event.preventDefault();
      openModal(daysModal);
    });
    daysModal.addEventListener("cancel", () => daysModal.close());
    themeToggle.addEventListener("click", toggleTheme);

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ
    daysModal.addEventListener("click", (event) => {
      const rect = daysModal.getBoundingClientRect();
      const isInDialog =
        rect.top <= event.clientY && event.clientY <= rect.bottom &&
        rect.left <= event.clientX && event.clientX <= rect.right;
      if (!isInDialog) {
        daysModal.close();
      }
    });

    // --- –§—É–Ω–∫—Ü–∏–∏ –ª–æ–≥–∏–∫–∏ –∏–≥—Ä—ã ---

    /**
     * –ü–µ—Ä–µ—Ç–∞—Å–æ–≤—ã–≤–∞–µ—Ç –∫–æ–ø–∏—é –º–∞—Å—Å–∏–≤–∞ –ø–æ –§–∏—à–µ—Ä—É‚Äì–ô–µ—Ç—Å—É
     * @template T
     * @param {T[]} items
     * @returns {T[]}
     */
    function shuffle(items) {
      const array = [...items];
      for (let i = array.length - 1; i > 0; i -= 1) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    /**
     * –°—Ç–∞—Ä—Ç –Ω–æ–≤–æ–π –∏–≥—Ä–æ–≤–æ–π —Å–µ—Å—Å–∏–∏
     */
    function startSession() {
      currentRound = 0;
      correctCount = 0;
      questionHistory = [];
      dayDeck = shuffle(DAYS);
      resultsSection.classList.remove("visible");
      resultsSection.setAttribute("aria-hidden", "true");
      progressFill.style.width = "0%";
      scoreText.textContent = "0 –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö";
      feedback.classList.remove("visible");
      nextRound();
    }

    /**
     * –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ä–∞—É–Ω–¥—É –∏–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
     */
    function nextRound() {
      if (currentRound >= TOTAL_ROUNDS) {
        showResults();
        return;
      }

      if (dayDeck.length === 0) {
        dayDeck = shuffle(DAYS);
      }

      currentQuestion = pickQuestion(dayDeck.pop());
      currentRound += 1;
      renderQuestion(currentQuestion);
      updateProgress();
    }

    /**
     * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤–æ–ø—Ä–æ—Å–∞
     * @param {{ru:string, fr:string, ipa:string, ruPron:string}} day
     */
    function pickQuestion(day) {
      const type = Math.random() < 0.5 ? QUESTION_TYPES.INPUT : QUESTION_TYPES.CHOICE;
      if (type === QUESTION_TYPES.CHOICE) {
        const distractors = shuffle(DAYS.filter((item) => item.ru !== day.ru)).slice(0, 3);
        const options = shuffle([day, ...distractors]);
        return { type, day, options };
      }
      return { type, day };
    }

    /**
     * –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç –≤–æ–ø—Ä–æ—Å –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
     * @param {{type:string, day:object, options?:object[]}} question
     */
    function renderQuestion(question) {
      questionBody.innerHTML = "";
      feedback.classList.remove("visible");
      feedback.removeAttribute("data-type");
      feedback.textContent = "";

      const metaText = question.type === QUESTION_TYPES.INPUT
        ? "–í–≤–µ–¥–∏—Ç–µ —Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–æ–µ —Å–ª–æ–≤–æ"
        : "–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–µ–≤–æ–¥ –Ω–∞ —Ä—É—Å—Å–∫–∏–π";
      questionTypeLabel.textContent = metaText;

      if (question.type === QUESTION_TYPES.INPUT) {
        renderInputQuestion(question);
      } else {
        renderChoiceQuestion(question);
      }
    }

    /**
     * –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç –≤–æ–ø—Ä–æ—Å —Å –≤–≤–æ–¥–æ–º
     */
    function renderInputQuestion(question) {
      const { day } = question;

      const prompt = document.createElement("p");
      prompt.className = "prompt";
      prompt.textContent = `–ö–∞–∫ –ø–æ-—Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∏ –±—É–¥–µ—Ç ¬´${day.ru}¬ª?`;

      const form = document.createElement("form");
      form.setAttribute("aria-label", `–í–≤–µ–¥–∏—Ç–µ —Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è ${day.ru}`);

      const input = document.createElement("input");
      input.type = "text";
      input.className = "text-input";
      input.name = "answer";
      input.autocomplete = "off";
      input.setAttribute("aria-describedby", "inputHint");
      input.required = true;

      const hint = document.createElement("span");
      hint.id = "inputHint";
      hint.className = "mnemonic";
      hint.innerHTML = `–ü–æ–¥—Å–∫–∞–∑–∫–∞: <span class="ipa">${day.ipa}</span> ‚Äî ${day.ruPron}`;

      const submitBtn = document.createElement("button");
      submitBtn.type = "submit";
      submitBtn.className = "primary-btn";
      submitBtn.textContent = "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å";

      form.append(input, submitBtn, hint);
      questionBody.append(prompt, form);
      input.focus();

      form.addEventListener("submit", (event) => {
        event.preventDefault();
        const userAnswerRaw = input.value;
        const validationResult = validateInput(userAnswerRaw);
        if (!validationResult.valid) {
          showFeedback(validationResult.message, false, day);
          return;
        }
        const userAnswer = normalizeText(userAnswerRaw);
        const isCorrect = userAnswer === normalizeText(day.fr);
        registerAnswer({
          round: currentRound,
          question: `¬´${day.ru}¬ª ‚Üí ?`,
          userAnswer: userAnswerRaw || "‚Äî",
          correctAnswer: `${day.fr} (${day.ipa}, ${day.ruPron})`,
          success: isCorrect
        });
        finalizeRound(isCorrect, day, userAnswerRaw);
      });

      input.addEventListener("keydown", (event) => {
        if (event.key === "Enter") {
          submitBtn.click();
        }
      });
    }

    /**
     * –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç –≤–æ–ø—Ä–æ—Å —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –≤—ã–±–æ—Ä–∞
     */
    function renderChoiceQuestion(question) {
      const { day, options } = question;

      const prompt = document.createElement("p");
      prompt.className = "prompt";
      prompt.innerHTML = `${day.fr} <span class="ipa">${day.ipa}</span> ‚Äî ${day.ruPron}. –ß—Ç–æ —ç—Ç–æ –∑–∞ –¥–µ–Ω—å –ø–æ-—Ä—É—Å—Å–∫–∏?`;

      const optionsWrapper = document.createElement("div");
      optionsWrapper.className = "options";
      optionsWrapper.setAttribute("role", "radiogroup");

      options.forEach((option, index) => {
        const button = document.createElement("button");
        button.type = "button";
        button.className = "option-btn";
        button.textContent = option.ru;
        button.setAttribute("role", "radio");
        button.setAttribute("aria-checked", "false");
        button.dataset.value = option.ru;

        button.addEventListener("click", () => {
          selectOption(button, optionsWrapper);
          checkChoiceAnswer(option, day, optionsWrapper);
        });

        button.addEventListener("keydown", (event) => handleOptionKeydown(event, optionsWrapper, index));

        optionsWrapper.appendChild(button);
      });

      questionBody.append(prompt, optionsWrapper);
      focusFirstOption(optionsWrapper);
    }

    /**
     * –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ —Å—Ç—Ä–µ–ª–∫–∞–º–∏
     */
    function handleOptionKeydown(event, container, index) {
      const buttons = Array.from(container.querySelectorAll(".option-btn"));
      const lastIndex = buttons.length - 1;
      if (["ArrowRight", "ArrowDown"].includes(event.key)) {
        event.preventDefault();
        const nextIndex = index === lastIndex ? 0 : index + 1;
        buttons[nextIndex].focus();
      }
      if (["ArrowLeft", "ArrowUp"].includes(event.key)) {
        event.preventDefault();
        const prevIndex = index === 0 ? lastIndex : index - 1;
        buttons[prevIndex].focus();
      }
      if (event.key === "Enter" || event.key === " ") {
        event.preventDefault();
        buttons[index].click();
      }
    }

    /**
     * –§–æ–∫—É—Å –Ω–∞ –ø–µ—Ä–≤—É—é –æ–ø—Ü–∏—é –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–µ
     */
    function focusFirstOption(container) {
      const first = container.querySelector(".option-btn");
      if (first) {
        first.focus();
      }
    }

    /**
     * –í—ã–±–æ—Ä –≤–∞—Ä–∏–∞–Ω—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
     */
    function selectOption(button, container) {
      container.querySelectorAll(".option-btn").forEach((btn) => {
        btn.setAttribute("aria-checked", "false");
      });
      button.setAttribute("aria-checked", "true");
    }

    /**
     * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç –∏–∑ —Å–ø–∏—Å–∫–∞
     */
    function checkChoiceAnswer(option, day, container) {
      const isCorrect = option.ru === day.ru;
      registerAnswer({
        round: currentRound,
        question: `${day.fr} (${day.ipa}, ${day.ruPron})`,
        userAnswer: option.ru,
        correctAnswer: `${day.ru}`,
        success: isCorrect
      });
      finalizeRound(isCorrect, day, option.ru);
      container.querySelectorAll(".option-btn").forEach((btn) => {
        btn.disabled = true;
      });
    }

    /**
     * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞
     */
    function validateInput(value) {
      if (!value.trim()) {
        return { valid: false, message: "–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç. –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –Ω–µ –∑–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è." };
      }
      return { valid: true };
    }

    /**
     * –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
     */
    function normalizeText(text) {
      return text
        .normalize("NFC")
        .toLowerCase()
        .replace(/\s+/g, " ")
        .trim();
    }

    /**
     * –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞—É–Ω–¥–∞: –ø–æ–∫–∞–∑ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –∏ –ø–µ—Ä–µ—Ö–æ–¥ –¥–∞–ª–µ–µ
     */
    function finalizeRound(isCorrect, day, userAnswerRaw) {
      if (isCorrect) {
        correctCount += 1;
      }
      const statusMessage = isCorrect ? "–í–µ—Ä–Ω–æ! –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞." : `–ù–µ–≤–µ—Ä–Ω–æ. –ü—Ä–∞–≤–∏–ª—å–Ω–æ: ${day.fr}`;
      showFeedback(statusMessage, isCorrect, day);
      updateProgress();
      setTimeout(() => nextRound(), 900);
    }

    /**
     * –ü–æ–∫–∞–∑ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
     */
    function showFeedback(message, isSuccess, day) {
      const icon = isSuccess
        ? '<svg aria-hidden="true" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5" /></svg>'
        : '<svg aria-hidden="true" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10" /><path d="M15 9l-6 6" /><path d="M9 9l6 6" /></svg>';

      feedback.innerHTML = `${icon}<span>${message}</span>`;
      feedback.setAttribute("data-type", isSuccess ? "success" : "error");
      const helper = document.createElement("div");
      helper.className = "mnemonic";
      helper.innerHTML = `${day.fr} ¬∑ <span class="ipa">${day.ipa}</span> ¬∑ ${day.ruPron}`;
      feedback.append(helper);
      feedback.classList.add("visible");
    }

    /**
     * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
     */
    function updateProgress() {
      progressText.textContent = `–†–∞—É–Ω–¥ ${Math.min(currentRound, TOTAL_ROUNDS)}/${TOTAL_ROUNDS}`;
      scoreText.textContent = `${correctCount} –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö`;
      const percent = (Math.min(currentRound, TOTAL_ROUNDS) / TOTAL_ROUNDS) * 100;
      progressFill.style.width = `${percent}%`;
    }

    /**
     * –§–∏–∫—Å–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∏—Å—Ç–æ—Ä–∏–∏
     */
    function registerAnswer(entry) {
      questionHistory.push(entry);
    }

    /**
     * –ü–æ–∫–∞–∑ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
     */
    function showResults() {
      const percent = Math.round((correctCount / TOTAL_ROUNDS) * 100);
      finalScore.textContent = `–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: ${correctCount} –∏–∑ ${TOTAL_ROUNDS} (${percent}%)`;
      resultsBody.innerHTML = "";
      questionHistory.forEach((item) => {
        const row = document.createElement("tr");
        const statusClass = item.success ? "success" : "error";
        row.innerHTML = `
          <td>${item.round}</td>
          <td>${item.question}</td>
          <td>${item.userAnswer}</td>
          <td><span class="tag ${statusClass}">${item.success ? "–≤–µ—Ä–Ω–æ" : "–æ—à–∏–±–∫–∞"}</span></td>
          <td>${item.correctAnswer}</td>
        `;
        resultsBody.appendChild(row);
      });
      resultsSection.classList.add("visible");
      resultsSection.setAttribute("aria-hidden", "false");
      feedback.classList.remove("visible");
      saveBestScore(correctCount);
      updateBestScoreBadge();
    }

    /**
     * –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑ localStorage
     */
    function loadBestScore() {
      const stored = localStorage.getItem("frenchDaysBest");
      return stored ? Number(stored) : null;
    }

    /**
     * –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
     */
    function saveBestScore(score) {
      if (bestScore === null || score > bestScore) {
        localStorage.setItem("frenchDaysBest", String(score));
        bestScore = score;
      }
    }

    /**
     * –û–±–Ω–æ–≤–ª—è–µ—Ç –±–µ–π–¥–∂ –ª—É—á—à–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
     */
    function updateBestScoreBadge() {
      if (bestScore !== null) {
        const percent = Math.round((bestScore / TOTAL_ROUNDS) * 100);
        bestScoreEl.textContent = `–õ–∏—á–Ω—ã–π —Ä–µ–∫–æ—Ä–¥: ${bestScore}/${TOTAL_ROUNDS} (${percent}%)`;
      } else {
        bestScoreEl.textContent = "";
      }
    }

    /**
     * –ó–∞–ø–æ–ª–Ω—è–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–∞–Ω–Ω—ã–º–∏
     */
    function populateModal() {
      modalBody.innerHTML = "";
      DAYS.forEach((day) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${day.fr}</td>
          <td class="ipa">${day.ipa}</td>
          <td>${day.ruPron}</td>
          <td>${day.ru}</td>
        `;
        modalBody.appendChild(row);
      });
    }

    /**
     * –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º —Ñ–æ–∫—É—Å–æ–º
     */
    function openModal(dialog) {
      if (typeof dialog.showModal === "function") {
        dialog.showModal();
      }
    }

    /**
     * –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–º–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
     */
    function toggleTheme() {
      const root = document.documentElement;
      const current = root.getAttribute("data-theme");
      const nextTheme = current === "dark" ? "light" : current === "light" ? null : "dark";
      if (nextTheme) {
        root.setAttribute("data-theme", nextTheme);
        localStorage.setItem("frenchDaysTheme", nextTheme);
        themeToggle.setAttribute("aria-pressed", nextTheme === "dark" ? "true" : "false");
      } else {
        root.removeAttribute("data-theme");
        localStorage.removeItem("frenchDaysTheme");
        themeToggle.setAttribute("aria-pressed", String(window.matchMedia("(prefers-color-scheme: dark)").matches));
      }
    }

    /**
     * –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é —Ç–µ–º—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
     */
    function applyStoredTheme() {
      const storedTheme = localStorage.getItem("frenchDaysTheme");
      if (storedTheme) {
        document.documentElement.setAttribute("data-theme", storedTheme);
        themeToggle.setAttribute("aria-pressed", storedTheme === "dark" ? "true" : "false");
      } else {
        themeToggle.setAttribute("aria-pressed", String(window.matchMedia("(prefers-color-scheme: dark)").matches));
      }
    }
  </script>
</body>
</html>
